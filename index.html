<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SIGESCON - Gestión de Contratos Empresariales</title>

    <link rel="stylesheet" href="css/style.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://unpkg.com/dexie@3.2.0/dist/dexie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.autotable.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-file-contract"></i> Gestión de Contratos Empresariales
            </div>
            <a href="ayuda.html" target="_blank" class="btn btn-primary help-btn">
                <i class="fas fa-question-circle"></i> Ayuda
            </a>
        </div>
    </header>

    <div class="main-container">
        <nav class="sidebar">
            <button class="tab-btn active" data-target="general-summary">
                <i class="fas fa-tachometer-alt"></i> Resumen General
            </button>
            <button class="tab-btn" data-target="new-edit-contract">
                <i class="fas fa-file-contract"></i> Nuevo/Editar Contrato
            </button>
            <button class="tab-btn" data-target="list-contracts">
                <i class="fas fa-list"></i> Lista de Contratos
            </button>
            <button class="tab-btn" data-target="hes-management">
                <i class="fas fa-clipboard-list"></i> Gestión de HES
            </button>
            <button class="tab-btn" data-target="advance-physical">
                <i class="fas fa-chart-line"></i> Avance Físico
            </button>
            <button class="tab-btn" data-target="graphic-summary">
                <i class="fas fa-chart-bar"></i> Resumen Gráfico
            </button>
            <button class="tab-btn" data-target="reports-view">
                <i class="fas fa-file-alt"></i> Informes
            </button>
        </nav>

        <main class="content">
            <div id="toast" class="toast"></div>

            <section id="general-summary" class="content-section active">
                <h2><i class="fas fa-tachometer-alt"></i> Resumen General</h2>
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Contratos Activos</h3>
                        <p id="active-contracts-count">0</p>
                    </div>
                    <div class="card">
                        <h3>Monto Total Contratado</h3>
                        <p id="total-contracted-amount">USD 0.00</p>
                    </div>
                    <div class="card">
                        <h3>Contratos por Vencer (30 días)</h3>
                        <p id="contracts-due-soon-count">0</p>
                    </div>
                    <div class="card">
                        <h3>Modalidades Registradas</h3>
                        <p id="total-modalities-count">0</p>
                    </div>
                </div>
            </section>

            <section id="new-edit-contract" class="content-section">
                <h2><i class="fas fa-file-contract"></i> Nuevo/Editar Contrato</h2>
                <form id="contract-form" class="contract-form">
                    <input type="hidden" id="contract-id">

                    <div class="form-group">
                        <label for="numero-proveedor">Número de Proveedor:</label>
                        <input type="text" id="numero-proveedor" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha-firma-contrato">Fecha de Firma del Contrato:</label>
                        <input type="date" id="fecha-firma-contrato" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha-creacion">Fecha de Creación:</label>
                        <input type="date" id="fecha-creacion" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha-inicio">Fecha de Inicio:</label>
                        <input type="date" id="fecha-inicio" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha-terminacion">Fecha de Terminación:</label>
                        <input type="date" id="fecha-terminacion" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="duracion-dias">Duración (Días):</label>
                        <input type="number" id="duracion-dias" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label for="numero-contrato-sicac">N° de Contrato SICAC:</label>
                        <input type="text" id="numero-contrato-sicac" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="division-area">División/Área:</label>
                        <input type="text" id="division-area" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="eemn">EEMN:</label>
                        <input type="text" id="eemn" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="region">Región:</label>
                        <input type="text" id="region" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="naturaleza-contratacion">Naturaleza de Contratación:</label>
                        <input type="text" id="naturaleza-contratacion" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="linea-servicio">Línea de Servicio:</label>
                        <input type="text" id="linea-servicio" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="no-peticion-oferta">N° de Petición Oferta:</label>
                        <input type="text" id="no-peticion-oferta" class="form-control">
                    </div>

                    <div class="form-group">
                        <label for="modalidad-contratacion">Modalidad de Contratación:</label>
                        <div class="input-group">
                            <select id="modalidad-contratacion" class="form-select" required>
                                </select>
                            <button type="button" class="btn btn-secondary" id="add-modality-btn" title="Añadir Modalidad">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button type="button" class="btn btn-danger" id="remove-modality-btn" title="Eliminar Modalidad Seleccionada">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="regimen-laboral">Régimen Laboral:</label>
                        <input type="text" id="regimen-laboral" class="form-control">
                    </div>
                    <div class="form-group full-width">
                        <label for="objeto-contractual">Objeto Contractual / Descripción:</label>
                        <textarea id="objeto-contractual" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="fecha-cambio-alcance">Fecha Cambio de Alcance:</label>
                        <input type="date" id="fecha-cambio-alcance" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="monto-original">Monto Original:</label>
                        <input type="number" step="0.01" id="monto-original" class="form-control" readonly value="0.00">
                    </div>
                    <div class="form-group">
                        <label for="monto-modificado">Monto Modificado:</label>
                        <input type="number" step="0.01" id="monto-modificado" class="form-control" value="0.00">
                    </div>
                    <div class="form-group">
                        <label for="monto-total-contrato">Monto Total del Contrato:</label>
                        <input type="number" step="0.01" id="monto-total-contrato" class="form-control" readonly value="0.00">
                    </div>
                    <div class="form-group">
                        <label for="numero-contrato">Número de Contrato:</label>
                        <input type="text" id="numero-contrato" class="form-control">
                    </div>
                    <div class="form-group full-width">
                        <label for="observaciones">Observaciones:</label>
                        <textarea id="observaciones" class="form-control" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="estatus-contrato">Estatus del Contrato:</label>
                        <select id="estatus-contrato" class="form-select" required>
                            <option value="Activo">Activo</option>
                            <option value="Inactivo">Inactivo</option>
                            <option value="Completado">Completado</option>
                            <option value="Cancelado">Cancelado</option>
                            <option value="En Revisión">En Revisión</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <h3>Partidas del Contrato</h3>
                        <button type="button" class="btn btn-primary btn-sm" id="add-partida-btn"><i class="fas fa-plus"></i> Añadir Partida</button>
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                <thead>
                                    <tr>
                                        <th>N°</th>
                                        <th>Descripción</th>
                                        <th>Cantidad</th>
                                        <th>UMD</th>
                                        <th>Precio Unitario</th>
                                        <th>Total</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="partidas-table-body">
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="adjuntar-archivos">Adjuntar Archivos:</label>
                        <input type="file" id="adjuntar-archivos" class="form-control" multiple>
                        <div id="attached-files-list" class="mt-2">
                            </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar Contrato</button>
                        <button type="button" class="btn btn-secondary" id="clear-form-btn"><i class="fas fa-eraser"></i> Limpiar Formulario</button>
                    </div>
                </form>
            </section>

            <section id="list-contracts" class="content-section">
                <h2><i class="fas fa-list"></i> Lista de Contratos</h2>
                <div class="filters-container">
                    <div class="form-group">
                        <label for="filter-proveedor">N° Proveedor:</label>
                        <input type="text" id="filter-proveedor" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="filter-sicac">N° SICAC:</label>
                        <input type="text" id="filter-sicac" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="filter-fecha-inicio">Fecha Inicio (Desde):</label>
                        <input type="date" id="filter-fecha-inicio" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="filter-fecha-final">Fecha Final (Hasta):</label>
                        <input type="date" id="filter-fecha-final" class="form-control">
                    </div>
                     <div class="form-group">
                        <label for="filter-modalidad">Modalidad:</label>
                        <select id="filter-modalidad" class="form-select">
                            <option value="Todos">Todos</option>
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="filter-estado">Estado:</label>
                        <select id="filter-estado" class="form-select">
                            <option value="Todos">Todos</option>
                            <option value="Activos">Activos</option>
                            <option value="Por Vencer (30 días)">Por Vencer (30 días)</option>
                            <option value="Vencidos">Vencidos</option>
                            <option value="Completado">Completado</option>
                            <option value="Cancelado">Cancelado</option>
                            <option value="En Revisión">En Revisión</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-primary" id="apply-filters-btn"><i class="fas fa-filter"></i> Aplicar Filtros</button>
                        <button class="btn btn-secondary" id="clear-filters-btn"><i class="fas fa-eraser"></i> Limpiar Filtros</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>N° Proveedor</th>
                                <th>N° SICAC</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Terminación</th>
                                <th>Duración (Días)</th>
                                <th>Monto Total</th>
                                <th>Avance Financiero (%)</th>
                                <th>Avance Físico (%)</th>
                                <th>Archivos Adjuntos</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="contract-list-body">
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="hes-management" class="content-section">
                <h2><i class="fas fa-clipboard-list"></i> Gestión de HES</h2>
                <div class="form-group">
                    <label for="hes-contract-select">Seleccionar Contrato:</label>
                    <select id="hes-contract-select" class="form-select">
                        <option value="">Cargando contratos...</option>
                    </select>
                </div>
                <p>Formulario y listado de HES pendientes de implementación.</p>
            </section>

            <section id="advance-physical" class="content-section">
                <h2><i class="fas fa-chart-line"></i> Avance Físico</h2>
                <form id="advance-form" class="advance-form">
                    <div class="form-group">
                        <label for="advance-contract-select">Contrato:</label>
                        <select id="advance-contract-select" class="form-select" required>
                            <option value="">Seleccione un Contrato</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="advance-date">Fecha del Avance:</label>
                        <input type="date" id="advance-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="advance-percentage">Porcentaje de Avance Físico:</label>
                        <input type="number" step="0.01" min="0" max="100" id="advance-percentage" class="form-control" required>
                    </div>
                    <div class="form-group full-width">
                        <label for="advance-description">Descripción del Avance:</label>
                        <textarea id="advance-description" class="form-control" rows="2"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success"><i class="fas fa-plus-circle"></i> Registrar Avance</button>
                    </div>
                </form>

                <h3>Historial de Avances Físicos</h3>
                <div class="table-responsive">
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Porcentaje</th>
                                <th>Descripción</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="advance-history-body">
                            <tr><td colspan="4" class="text-center">Seleccione un contrato para ver su historial.</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="graphic-summary" class="content-section">
                <h2><i class="fas fa-chart-bar"></i> Resumen Gráfico</h2>
                <div class="chart-container">
                    <canvas id="contractsChart"></canvas>
                </div>
                <p>Aquí se mostrarán gráficos de resumen.</p>
            </section>

            <section id="reports-view" class="content-section">
                <h2><i class="fas fa-file-alt"></i> Informes</h2>
                <p>Generación de informes personalizados.</p>
            </section>

        </main>
    </div>

    <footer class="footer">
        <p>
            &copy; 2025 SIGESCON - Gestión de Contratos Empresariales.
            Todos los derechos reservados.
            | Desarrollado por RojasTech -
            <a href="mailto:angeljrojasm@gmail.com"> Enviar Correo</a>
        </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="js/script.js"></script>
</body>
</html>