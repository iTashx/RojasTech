<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Contratos Empresariales</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-building"></i>
                <h1>Gestión de Contratos Empresariales</h1>
            </div>
            <a href="ayuda.html" target="_blank" class="btn btn-info help-btn">
                <i class="fas fa-question-circle"></i> Ayuda
            </a>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <button class="tab-btn active" data-tab="dashboard-section"><i class="fas fa-tachometer-alt"></i> Resumen General</button>
            <button class="tab-btn" data-tab="contract-management-section"><i class="fas fa-file-contract"></i> Nuevo/Editar Contrato</button>
            <button class="tab-btn" data-tab="contract-list-section"><i class="fas fa-list-alt"></i> Lista de Contratos</button>
            <button class="tab-btn" data-tab="hes-management-section"><i class="fas fa-file-invoice"></i> Gestión de HES</button>
            <button class="tab-btn" data-tab="advance-management-section"><i class="fas fa-money-bill-wave"></i> Avance Físico</button> <button class="tab-btn" data-tab="reports-section"><i class="fas fa-chart-bar"></i> Resumen Gráfico</button> </aside>

        <main class="content">
            <section id="dashboard-section" class="content-section active">
                <h2><i class="fas fa-tachometer-alt"></i> Resumen General</h2>
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>Contratos Activos</h3>
                        <p id="total-contracts">0</p>
                    </div>
                    <div class="card">
                        <h3>Monto Total Contratado</h3>
                        <p id="total-contracted-amount">$0.00</p>
                    </div>
                    <div class="card">
                        <h3>Anticipos Pendientes</h3>
                        <p id="pending-advances">$0.00</p>
                    </div>
                    <div class="card">
                        <h3>HES Pendientes</h3>
                        <p id="pending-hes">0</p>
                    </div>
                </div>
                <h3>Avance Físico General</h3>
                <div class="chart-container">
                    <canvas id="dashboardPhysicalAdvanceChart"></canvas>
                </div>
                <h3>Distribución de Contratos por Estado</h3>
                <div class="chart-container">
                    <canvas id="dashboardContractStatusChart"></canvas>
                </div>
            </section>

            <section id="contract-management-section" class="content-section">
                <h2><i class="fas fa-file-contract"></i> Nuevo/Editar Contrato</h2>
                <form id="contract-form" class="contract-form">
                    <h3>Detalles del Contrato</h3>
                    <input type="hidden" id="contract-db-id"> <div class="form-group">
                        <label for="numero-proveedor">Número de Proveedor:</label>
                        <input type="text" id="numero-proveedor" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha-firma-contrato">Fecha Firma del Contrato:</label>
                        <input type="date" id="fecha-firma-contrato" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha-creado">Fecha Creado:</label>
                        <input type="date" id="fecha-creado" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha-inicio">Fecha Inicio:</label>
                        <input type="date" id="fecha-inicio" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fecha-terminacion">Fecha Terminación:</label>
                        <input type="date" id="fecha-terminacion" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="periodo-culminacion-dias">Periodo de Culminación (Días):</label>
                        <input type="number" id="periodo-culminacion-dias" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="n-sicac">N° Contrato SICAC:</label>
                        <input type="text" id="n-sicac" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="division-area">División/Área:</label>
                        <input type="text" id="division-area" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="eemn">EEMN:</label>
                        <input type="text" id="eemn" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="region">Región:</label>
                        <input type="text" id="region" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="naturaleza-contratacion">Naturaleza de Contratación:</label>
                        <input type="text" id="naturaleza-contratacion" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="linea-servicio">Línea de Servicio:</label>
                        <input type="text" id="linea-servicio" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="no-peticion-oferta">No. Petición de Oferta:</label>
                        <input type="text" id="no-peticion-oferta" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="modalidad-contratacion">Modalidad de Contratación:</label>
                        <div class="input-group">
                            <input type="text" id="modalidad-contratacion" class="form-control">
                            <button type="button" class="btn btn-success" disabled><i class="fas fa-plus"></i></button>
                            <button type="button" class="btn btn-danger" disabled><i class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="regimen-laboral">Régimen Laboral:</label>
                        <input type="text" id="regimen-laboral" class="form-control">
                    </div>
                    <div class="form-group full-width">
                        <label for="descripcion-contrato">Objeto Contractual / Descripción:</label>
                        <textarea id="descripcion-contrato" class="form-control" rows="3" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="fecha-cambio-alcance">Fecha Cambio de Alcance:</label>
                        <input type="date" id="fecha-cambio-alcance" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="monto-original">Monto Original:</label>
                        <input type="number" id="monto-original" class="form-control" step="0.01" value="0.00" readonly>
                    </div>
                    <div class="form-group">
                        <label for="monto-modificado">Monto Modificado:</label>
                        <input type="number" id="monto-modificado" class="form-control" step="0.01" value="0.00">
                    </div>
                    <div class="form-group">
                        <label for="monto-total-contrato">Monto Total del Contrato:</label>
                        <input type="number" id="monto-total-contrato" class="form-control" step="0.01" value="0.00" readonly>
                    </div>
                     <div class="form-group">
                        <label for="no-contrato-interno">No. Contrato (Interno):</label>
                        <input type="text" id="no-contrato-interno" class="form-control">
                    </div>
                    <div class="form-group full-width">
                        <label for="observaciones">Observaciones:</label>
                        <textarea id="observaciones" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="estatus-contrato">Estatus:</label>
                        <select id="estatus-contrato" class="form-select" required>
                            <option value="Activo">Activo</option>
                            <option value="En Revisión">En Revisión</option>
                            <option value="Finalizado">Finalizado</option>
                            <option value="Suspendido">Suspendido</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tipo-moneda">Moneda:</label>
                        <select id="tipo-moneda" class="form-select" required>
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="VES">VES</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="adjuntar-archivos">Adjuntar Archivos:</label>
                        <input type="file" id="adjuntar-archivos" class="form-control">
                    </div>

                    <h3 class="full-width">Partidas del Contrato</h3>
                    <div class="table-responsive full-width">
                        <table id="partidas-table" class="table">
                            <thead>
                                <tr>
                                    <th>N°</th>
                                    <th>Descripción</th>
                                    <th>Cantidad</th>
                                    <th>UMD</th>
                                    <th>Precio Unitario</th>
                                    <th>Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="partidas-table-body">
                                </tbody>
                        </table>
                    </div>
                    <div class="form-actions full-width">
                        <button type="button" id="add-partida-btn" class="btn btn-success"><i class="fas fa-plus"></i> Añadir Partida</button>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar/Actualizar Contrato</button>
                        <button type="button" id="clear-contract-form-btn" class="btn btn-danger"><i class="fas fa-eraser"></i> Limpiar Formulario</button>
                    </div>
                </form>
            </section>

            <section id="contract-list-section" class="content-section">
                <h2><i class="fas fa-list-alt"></i> Lista de Contratos</h2>
                <div class="filters-container">
                    <div class="form-group">
                        <label for="filter-contract-number">N° Proveedor:</label>
                        <input type="text" id="filter-contract-number" class="form-control" placeholder="Filtrar por N° Proveedor">
                    </div>
                    <div class="form-group">
                        <label for="filter-sicac">N° SICAC:</label>
                        <input type="text" id="filter-sicac" class="form-control" placeholder="Filtrar por N° SICAC">
                    </div>
                    <div class="form-group">
                        <label for="filter-fecha-inicio">Fecha Inicio:</label>
                        <input type="date" id="filter-fecha-inicio" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="filter-fecha-final">Fecha Final:</label>
                        <input type="date" id="filter-fecha-final" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="filter-modalidad">Modalidad:</label>
                        <input type="text" id="filter-modalidad" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="filter-status">Estado:</label>
                        <select id="filter-status" class="form-select">
                            <option value="">Todos</option>
                            <option value="Activo">Activo</option>
                            <option value="En Revisión">En Revisión</option>
                            <option value="Finalizado">Finalizado</option>
                            <option value="Suspendido">Suspendido</option>
                            <option value="Cancelado">Cancelado</option>
                        </select>
                    </div>
                    <div class="filter-actions">
                        <button type="button" id="apply-filters-btn" class="btn btn-info"><i class="fas fa-filter"></i> Aplicar Filtros</button>
                        <button type="button" id="clear-filters-btn" class="btn btn-secondary"><i class="fas fa-times"></i> Limpiar Filtros</button>
                    </div>
                </div>

                <div class="form-actions" style="justify-content: flex-start; margin-top: 0; margin-bottom: var(--spacing-md);">
                    <button type="button" id="export-excel-btn" class="btn btn-success"><i class="fas fa-file-excel"></i> Exportar a Excel</button>
                    <button type="button" id="export-pdf-btn" class="btn btn-danger"><i class="fas fa-file-pdf"></i> Exportar a PDF</button>
                </div>

                <div class="table-responsive">
                    <table id="contracts-list-table" class="table">
                        <thead>
                            <tr>
                                <th>N° PROVEEDOR</th>
                                <th>N° SICAC</th>
                                <th>FECHA INICIO</th>
                                <th>FECHA FINAL</th>
                                <th>DURACIÓN (DÍAS)</th>
                                <th>MONTO TOTAL</th>
                                <th>ARCHIVOS</th>
                                <th>ACCIONES</th>
                            </tr>
                        </thead>
                        <tbody id="contracts-table-body">
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="hes-management-section" class="content-section">
                <h2><i class="fas fa-file-invoice"></i> Gestión de HES (Hoja de Entrada de Servicio)</h2>
                <form id="hes-form" class="hes-form">
                    <input type="hidden" id="hes-db-id"> <div class="form-group">
                        <label for="hes-contract-id">Contrato Asociado:</label>
                        <select id="hes-contract-id" class="form-select" required>
                            <option value="">Seleccione un contrato</option>
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="hes-date">Fecha de HES:</label>
                        <input type="date" id="hes-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hes-description">Descripción de Servicio/Bien:</label>
                        <input type="text" id="hes-description" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="hes-amount">Monto HES (sin IVA):</label>
                        <input type="number" id="hes-amount" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="hes-status">Estado HES:</label>
                        <select id="hes-status" class="form-select" required>
                            <option value="Pendiente">Pendiente</option>
                            <option value="Aprobado">Aprobado</option>
                            <option value="Rechazado">Rechazado</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="hes-notes">Notas:</label>
                        <textarea id="hes-notes" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label for="hes-attach-document">Adjuntar Documento (PDF, Imagen):</label>
                        <input type="file" id="hes-attach-document" class="form-control">
                    </div>
                    <div class="form-actions full-width">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar HES</button>
                        <button type="button" id="clear-hes-form-btn" class="btn btn-danger"><i class="fas fa-eraser"></i> Limpiar Formulario</button>
                    </div>
                </form>

                <h3 style="margin-top: var(--spacing-lg);">Lista de HES</h3>
                <div class="table-responsive">
                    <table id="hes-list-table" class="table">
                        <thead>
                            <tr>
                                <th>ID HES</th>
                                <th>Contrato</th>
                                <th>Fecha</th>
                                <th>Descripción</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="hes-table-body">
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="advance-management-section" class="content-section">
                <h2><i class="fas fa-chart-line"></i> Avance Físico</h2>
                <form id="physical-advance-form" class="contract-form"> <input type="hidden" id="physical-advance-db-id"> <div class="form-group">
                        <label for="physical-advance-contract-id">Seleccionar Contrato:</label>
                        <select id="physical-advance-contract-id" class="form-select" required>
                            <option value="">Seleccione un contrato</option>
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="physical-advance-date">Fecha de Avance:</label>
                        <input type="date" id="physical-advance-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="physical-advance-percentage">Porcentaje de Avance (%):</label>
                        <input type="number" id="physical-advance-percentage" class="form-control" step="0.01" min="0" max="100" required>
                    </div>
                    <div class="form-group full-width">
                        <label for="physical-advance-comments">Comentarios:</label>
                        <textarea id="physical-advance-comments" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-actions full-width">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar Avance</button>
                        <button type="button" id="clear-physical-advance-form-btn" class="btn btn-danger"><i class="fas fa-eraser"></i> Limpiar Formulario</button>
                    </div>
                </form>

                <h3 style="margin-top: var(--spacing-lg);">Avances Físicos Registrados</h3>
                 <div class="table-responsive">
                    <table id="physical-advances-list-table" class="table">
                        <thead>
                            <tr>
                                <th>ID Contrato</th>
                                <th>Fecha</th>
                                <th>Porcentaje (%)</th>
                                <th>Comentarios</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="physical-advances-table-body">
                            </tbody>
                    </table>
                </div>
            </section>

            <section id="reports-section" class="content-section">
                <h2><i class="fas fa-chart-bar"></i> Resumen Gráfico</h2>
                <p>Aquí se mostrarán gráficos de resumen del estado de los contratos.</p>

                <div class="export-buttons" style="margin-bottom: var(--spacing-md);">
                    <button id="exportGraphicPdfBtn" class="btn btn-danger"><i class="fas fa-file-pdf"></i> Exportar PDF</button>
                    <button id="exportGraphicImageBtn" class="btn btn-success"><i class="fas fa-image"></i> Exportar Imagen (Primer Gráfico)</button>
                </div>

                <div class="dashboard-cards"> <div class="card" style="background-color: var(--card-background); color: var(--text-color); text-align: left; padding: var(--spacing-md); ">
                        <h3>Avance Físico de Contratos</h3>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="reportsPhysicalAdvanceChart"></canvas>
                        </div>
                    </div>
                    <div class="card" style="background-color: var(--card-background); color: var(--text-color); text-align: left; padding: var(--spacing-md);">
                        <h3>Montos por Modalidad de Contratación</h3>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="reportsContractModalitiesChart"></canvas>
                        </div>
                    </div>
                    <div class="card" style="background-color: var(--card-background); color: var(--text-color); text-align: left; padding: var(--spacing-md);">
                        <h3>Estado de Contratos</h3>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="reportsContractStatusChart"></canvas>
                        </div>
                    </div>
                    <div class="card" style="background-color: var(--card-background); color: var(--text-color); text-align: left; padding: var(--spacing-md);">
                        <h3>Contratos por Región</h3>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="reportsContractRegionChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <footer class="footer">
        <p>&copy; 2024 SIGESCON - Gestión de Contratos Empresariales. Todos los derechos reservados. | Desarrollado por RojasTech - Contacto: <a href="mailto:tucorreo@ejemplo.com">Enviar Correo</a></p>
    </footer>

    <div id="toast" class="toast"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dexie@3.2.3/dist/dexie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="js/script.js"></script>
</body>
</html>